<div role="modal" aria-labeled-by="modalLabel">
  <div class="modal-header">
    <button type="button" class="close pull-right" aria-label="Cancel edits"
            confirm="Are you sure you wish to cancel editing? Your changes will not be saved."
            confirm-ok="Yes"
            confirm-cancel="No"
            confirm-settings="{animation: false, keyboard: false, backdrop: 'static'}"
            ng-click="vm.cancel()"><span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title" id="modalLabel">Certification Criteria: {{ vm.cert.number }}</h4>
  </div>
  <div class="modal-body" ng-form="vm.editForm">
    <input type="checkbox" ng-model="vm.cert.success" id="data{{ vm.cert.number }}" name="data"></input>
    <label class="control-label" for="data{{ vm.cert.number }}">{{ vm.cert.number }}: {{ vm.cert.title }}</label>
    <div ng-if="vm.cert.success">
      <input type="checkbox" ng-model="vm.cert.metViaAdditionalSoftware" id="data_additionalSoftware{{ vm.cert.number }}" name="data_additionalSoftware"></input>
      <label class="control-label" for="data_additionalSoftware{{ vm.cert.number }}">Certification met via relied upon software</label>
      <ai-additional-software additional-software="vm.cert.additionalSoftware" is-editing="true" ng-if="vm.cert.metViaAdditionalSoftware"></ai-additional-software>
    </div>
    <table class="table table-striped" ng-if="vm.cert.success">
      <thead>
        <tr>
          <th scope="col">Attribute</th>
          <th scope="col">Value</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-if="vm.cert.gap !== null">
          <td><label class="control-label" for="data_gap{{ vm.cert.number }}">GAP</label></td>
          <td><select class="form-control input-sm" id="data_gap{{ vm.cert.number }}" name="data_gap" ng_model="vm.cert.gap" ng-options="b.value as b.name for b in vm.options"></select></td>
        </tr>
        <tr ng-if="vm.cert.testStandards !== null">
          <td>Standard</td>
          <td>
            <div class="form-horizontal">
              <div class="form-group form-group-sm" ng-repeat="item in vm.cert.testStandards track by $index">
                <label class="col-sm-6 control-label" for="testStandard{{ item.id }}">Test Standard</label>
                <div class="col-sm-6">
                  <div class="input-group">
                    <select class="form-control" ng-model="item.testStandardName" id="testStandard{{ item.id }}" name="testStandard{{ item.id }}"
                            ng-options="option.name as option.name for option in vm.resources.testStandards.data | orderBy: 'name'"
                            ng-change="item.testStandardId = option.id" required>
                    </select>
                    <div class="input-group-btn"><button class="btn btn-danger form-control" ng-click="vm.cert.testStandards.splice($index,1)"><i class="fa fa-trash"></i> <span class="sr-only">Remove item</span></button></div>
                  </div>
                  <div class="text-danger" ng-if="vm.editForm['testStandardName' + item.id].$error.required">Field is required</div>
                </div>
              </div>
              <div class="form-group form-group-sm">
                <label class="col-sm-6 control-label" for="newTestStandardItem">New Test Standard</label>
                <div class="col-sm-6">
                  <div class="input-group">
                    <select class="form-control" ng-model="vm.newTestStandard.testStandardName" id="newTestStandardItem"
                            ng-options="option.name as option.name for option in vm.resources.testStandards.data | orderBy: 'name'">
                    </select>
                    <div class="input-group-btn"><button class="btn btn-ai-success form-control" ng-click="vm.addNewValue(vm.cert.testStandards, vm.newTestStandard); vm.newTestStandard = {}"><i class="fa fa-plus"></i> <span class="sr-only">Add item</span></button></div>
                  </div>
                </div>
                <label class="col-sm-6 control-label" for="newTestStandardExpandableName">Add new Test Standard to available options</label>
                <div class="col-sm-6">
                  <input type="text" class="form-control" ng-model="vm.newTestStandard.expandableName" id="newTestStandardExpandableName" ng-change="vm.extendSelect(vm.resources.testStandards.data, vm.newTestStandard.expandableName); vm.newTestStandard.testStandardName = vm.newTestStandard.expandableName"></input>
                </div>
              </div>
            </div>
          </td>
        </tr>
        <tr ng-if="vm.cert.g1Success !== null">
          <td><label class="control-label" for="data_g1Success{{ vm.cert.number }}">Measure Successfully Tested for G1</label></td>
          <td><select class="form-control input-sm" id="data_g1Success{{ vm.cert.number }}" name="data_g1Success" ng_model="vm.cert.g1Success" ng-options="b.value as b.name for b in vm.options"></select></td>
        </tr>
        <tr ng-if="vm.cert.g1MacraMeasures">
          <td><label class="control-label" for="data_g1MacraMeasures{{ vm.cert.number }}">Measure<span ng-if="vm.cert.g1MacraMeasures.length !== 1">s</span> Successfully Tested for G1</label></td>
          <td>
            <select multiple data-ng-attr-size="{{ vm.cert.allowedMacraMeasures.length + 1 }}" class="form-control input-sm" id="data_g1MacraMeasures{{ vm.cert.number }}" name="data_g1MacraMeasures" ng_model="vm.cert.g1MacraMeasures" ng-options="m as m.abbreviation for m in vm.cert.allowedMacraMeasures | orderBy: 'abbreviation' track by m.id"></select></td>
        </tr>
        <tr ng-if="vm.cert.g2Success !== null">
          <td><label class="control-label" for="data_g2Success{{ vm.cert.number }}">Measure Successfully Tested for G2</label></td>
          <td><select class="form-control input-sm" id="data_g2Success{{ vm.cert.number }}" name="data_g2Success" ng_model="vm.cert.g2Success" ng-options="b.value as b.name for b in vm.options"></select></td>
        </tr>
        <tr ng-if="vm.cert.g2MacraMeasures">
          <td><label class="control-label" for="data_g2MacraMeasures{{ vm.cert.number }}">Measure<span ng-if="vm.cert.g2MacraMeasures.length !== 1">s</span> Successfully Tested for G2</label></td>
          <td><select multiple data-ng-attr-size="{{ vm.cert.allowedMacraMeasures.length + 1 }}" class="form-control input-sm" id="data_g2MacraMeasures{{ vm.cert.number }}" name="data_g2MacraMeasures" ng_model="vm.cert.g2MacraMeasures" ng-options="m as m.abbreviation for m in vm.cert.allowedMacraMeasures | orderBy: 'abbreviation' track by m.id"></select></td>
        </tr>
        <tr ng-if="vm.cert.testFunctionality !== null">
          <td>Functionality Tested</td>
          <td>
            <div class="form-horizontal">
              <div class="form-group form-group-sm" ng-repeat="item in vm.cert.testFunctionality track by $index">
                <label class="col-sm-6 control-label" for="functionalityTested{{ item.id }}">Functionality Tested</label>
                <div class="col-sm-6">
                  <div class="input-group">
                    <select class="form-control" ng-model="item.name" id="functionalityTested{{ item.id }}" name="functionalityTested{{ item.id }}"
                            ng-options="option.name as option.name for option in vm.resources.testFunctionalities.data | orderBy: 'name'"
                            ng-change="item.testFunctionalityId = option.id" required>
                    </select>
                    <div class="input-group-btn"><button class="btn btn-danger form-control" ng-click="vm.cert.testFunctionality.splice($index,1)"><i class="fa fa-trash"></i> <span class="sr-only">Remove item</span></button></div>
                  </div>
                  <div class="text-danger" ng-if="vm.editForm['functionalityTested' + item.id].$error.required">Field is required</div>
                </div>
              </div>
              <div class="form-group form-group-sm">
                <label class="col-sm-6 control-label" for="newFunctionalityTestedItem">New Functionality Tested</label>
                <div class="col-sm-6">
                  <div class="input-group">
                    <select class="form-control" ng-model="vm.newFunctionalityTested.name" id="newFunctionalityTestedItem"
                            ng-options="option.name as option.name for option in vm.resources.testFunctionalities.data | orderBy: 'name'">
                    </select>
                    <div class="input-group-btn"><button class="btn btn-ai-success form-control" ng-click="vm.addNewValue(vm.cert.testFunctionality, vm.newFunctionalityTested); vm.newFunctionalityTested = {}"><i class="fa fa-plus"></i> <span class="sr-only">Add item</span></button></div>
                  </div>
                </div>
              </div>
            </div>
          </td>
        </tr>
        <tr ng-if="vm.cert.testProcedures !== null">
          <td>Test procedure</td>
          <td>
            <div class="form-horizontal">
              <div class="form-group form-group-sm" ng-repeat="item in vm.cert.testProcedures track by $index">
                <label class="col-sm-6 control-label" for="testProcedure{{ item.id }}">Test Procedure</label>
                <div class="col-sm-6">
                  <div class="input-group">
                    <select class="form-control" ng-model="item.testProcedure.id" id="testProcedure{{ item.id }}" name="testProcedure{{ item.id }}"
                            ng-options="option.id as option.name for option in vm.availableTestProcedures | orderBy: 'name'" required>
                    </select>
                    <div class="input-group-btn"><button class="btn btn-danger form-control" ng-click="vm.cert.testProcedures.splice($index,1)"><i class="fa fa-trash"></i> <span class="sr-only">Remove item</span></button></div>
                  </div>
                  <div class="text-danger" ng-if="vm.editForm['testProcedure' + item.id ].$error.required">Field is required</div>
                </div>
                <label class="col-sm-6 control-label" for="testProcedureVersion{{ item.id }}">Test Procedure Version</label>
                <div class="col-sm-6">
                  <input type="text" class="form-control" ng-model="item.testProcedureVersion" id="testProcedureVersion{{ item.id }}" name="testProcedureVersion{{ item.id }}" ng-maxlength="50" required></input>
                  <div class="text-danger" ng-if="vm.editForm['testProcedureVersion' + item.id].$error.required">Field is required</div>
                  <div class="text-danger" ng-if="vm.editForm['testProcedureVersion' + item.id].$error.maxlength">Field is too long</div>
                </div>
              </div>
              <div class="form-group form-group-sm">
                <label class="col-sm-6 control-label" for="newTestProcedureItem">New Test Procedure</label>
                <div class="col-sm-6">
                  <div class="input-group">
                    <select class="form-control" ng-model="vm.newTestProcedure.testProcedure" id="newTestProcedureItem"
                            ng-options="option as option.name for option in vm.availableTestProcedures | orderBy: 'name'">
                    </select>
                    <div class="input-group-btn"><button class="btn btn-ai-success form-control" ng-click="vm.addNewValue(vm.cert.testProcedures, vm.newTestProcedure); vm.newTestProcedure = {}"><i class="fa fa-plus"></i> <span class="sr-only">Add item</span></button></div>
                  </div>
                </div>
                <label class="col-sm-6 control-label" for="newTestProcedureVersion">Test Procedure Version</label>
                <div class="col-sm-6">
                  <input type="text" class="form-control" ng-model="vm.newTestProcedure.testProcedureVersion" id="newTestProcedureVersion" id="newTestProcedureVersion" ng-maxlength="50"></input>
                  <div class="text-danger" ng-if="vm.editForm.newTestProcedureVersion.$error.maxlength">Field is too long</div>
                </div>
              </div>
            </div>
          </td>
        </tr>
        <tr ng-if="vm.cert.testToolsUsed !== null">
          <td>Test tool</td>
          <td>
            <div class="form-horizontal">
              <div class="form-group form-group-sm" ng-repeat="item in vm.cert.testToolsUsed track by $index">
                <div ng-if="!item.retired">
                  <label class="col-sm-6 control-label" for="testTool{{ item.id }}">Test Tool</label>
                  <div class="col-sm-6">
                    <div class="input-group">
                      <select class="form-control" ng-model="item.testToolName" id="testTool{{ item.id }}" name="testTool{{ item.id }}"
                              ng-options="option.name as option.name disable when !vm.isToolAvailable(option) for option in vm.resources.testTools.data | orderBy: 'name'"
                              ng-change="item.testToolId = option.id" required>
                      </select>
                      <div class="input-group-btn"><button class="btn btn-danger form-control" ng-click="vm.cert.testToolsUsed.splice($index,1)"><i class="fa fa-trash"></i> <span class="sr-only">Remove item</span></button></div>
                    </div>
                    <div class="text-danger" ng-if="vm.editForm['testTool' + item.id].$error.required">Field is required</div>
                  </div>
                  <label class="col-sm-6 control-label" for="testToolVersion{{ item.id }}">Test Tool Version</label>
                  <div class="col-sm-6">
                    <input type="text" class="form-control" ng-model="item.testToolVersion" id="testToolVersion{{ item.id }}" name="testToolVersion{{ item.id }}" ng-maxlength="50"></input>
                    <div class="text-danger" ng-if="vm.editForm['testToolVersion' + item.id].$error.maxlength">Field is too long</div>
                  </div>
                </div>
                <div ng-if="item.retired">
                  <label class="col-sm-6 control-label" for="testTool{{ item.id }}">Test Tool</label>
                  <div class="col-sm-6">
                    <input type="text" class="form-control" ng-model="item.testToolName" id="testTool{{ item.id }}" disabled></input>
                    Tool has been retired
                  </div>
                  <label class="col-sm-6 control-label" for="testToolVersion{{ item.id }}">Test Tool Version</label>
                  <div class="col-sm-6">
                    <input type="text" class="form-control" ng-model="item.testToolVersion" id="testToolVersion{{ item.id }}" disabled></input>
                  </div>
                </div>
              </div>
              <div class="form-group form-group-sm">
                <label class="col-sm-6 control-label" for="newTestToolItem">New Test Tool</label>
                <div class="col-sm-6">
                  <div class="input-group">
                    <select class="form-control" ng-model="vm.newTestTool.testToolName" id="newTestToolItem"
                            ng-options="option.name as option.name disable when !vm.isToolAvailable(option) for option in vm.resources.testTools.data | orderBy: 'name'">
                    </select>
                    <div class="input-group-btn"><button class="btn btn-ai-success form-control" ng-click="vm.addNewValue(vm.cert.testToolsUsed, vm.newTestTool); vm.newTestTool = {}"><i class="fa fa-plus"></i> <span class="sr-only">Add item</span></button></div>
                  </div>
                </div>
                <label class="col-sm-6 control-label" for="newTestToolVersion">Test Tool Version</label>
                <div class="col-sm-6">
                  <input type="text" class="form-control" ng-model="vm.newTestTool.testToolVersion" id="newTestToolVersion" id="newTestToolVersion" ng-maxlength="50"></input>
                  <div class="text-danger" ng-if="vm.editForm.newTestToolVersion.$error.maxlength">Field is too long</div>
                </div>
              </div>
            </div>
          </td>
        </tr>
        <tr ng-if="vm.cert.testDataUsed !== null && vm.availableTestData && vm.availableTestData.length > 0">
          <td>Test data</td>
          <td>
            <div class="form-horizontal">
              <div class="form-group form-group-sm" ng-repeat="item in vm.cert.testDataUsed track by $index">
                <label class="col-sm-6 control-label" for="testData{{ item.id }}">Test Data</label>
                <div class="col-sm-6">
                  <div class="input-group">
                    <select class="form-control" ng-model="item.testData.id" id="testData{{ item.id }}" name="testData{{ item.id }}"
                            ng-options="option.id as option.name for option in vm.availableTestData | orderBy: 'name'" required>
                    </select>
                    <div class="input-group-btn"><button class="btn btn-danger form-control" ng-click="vm.cert.testDataUsed.splice($index,1)"><i class="fa fa-trash"></i> <span class="sr-only">Remove item</span></button></div>
                  </div>
                  <div class="text-danger" ng-if="vm.editForm['testData' + item.id].$error.required">Field is required</div>
                </div>
                <label class="col-sm-6 control-label" for="testDataVersion{{ item.id }}">Version</label>
                <div class="col-sm-6">
                  <input type="text" class="form-control" ng-model="item.version" id="testDataVersion{{ item.id }}" name="testDataVersion{{ item.id }}" ng-maxlength="50" required></input>
                  <div class="text-danger" ng-if="vm.editForm['testDataVersion' + item.id].$error.required">Field is required</div>
                  <div class="text-danger" ng-if="vm.editForm['testDataVersion' + item.id].$error.maxlength">Field is too long</div>
                </div>
                <label class="col-sm-6 control-label" for="testDataAlteration{{ item.id }}">Alteration</label>
                <div class="col-sm-6">
                  <input type="text" class="form-control" ng-model="item.alteration" id="testDataAlteration{{ item.id }}" name="testDataAlteration{{ item.id }}"></input>
                </div>
              </div>
              <div class="form-group form-group-sm">
                <label class="col-sm-6 control-label" for="newTestDataItem">New Test Data</label>
                <div class="col-sm-6">
                  <div class="input-group">
                    <select class="form-control" ng-model="vm.newTestData.testData" id="newTestDataItem"
                            ng-options="option as option.name for option in vm.availableTestData | orderBy: 'name'">
                    </select>
                    <div class="input-group-btn"><button class="btn btn-ai-success form-control" ng-click="vm.addNewValue(vm.cert.testDataUsed, vm.newTestData); vm.newTestData = {}"><i class="fa fa-plus"></i> <span class="sr-only">Add item</span></button></div>
                  </div>
                </div>
                <label class="col-sm-6 control-label" for="newTestDataVersion">Version</label>
                <div class="col-sm-6">
                  <input type="text" class="form-control" ng-model="vm.newTestData.version" id="newTestDataVersion" id="newTestDataVersion" ng-maxlength="50"></input>
                  <div class="text-danger" ng-if="vm.editForm.newTestDataVersion.$error.maxlength">Field is too long</div>
                </div>
                <label class="col-sm-6 control-label" for="newTestDataAlteration">Alteration</label>
                <div class="col-sm-6">
                  <input type="text" class="form-control" ng-model="vm.newTestData.alteration" id="newTestDataAlteration" id="newTestDataAlteration"></input>
                </div>
              </div>
            </div>
          </td>
        </tr>
        <tr ng-if="vm.cert.apiDocumentation !== null">
          <td><label class="control-label" for="data_api{{ vm.cert.number }}">API Documentation</label></td>
          <td>
            <input class="form-control input-sm" type="url" id="data_api{{ vm.cert.number }}" name="data_apiDocumentation" ng-model="vm.cert.apiDocumentation" ng-maxlength="1024"></input>
            <div class="text-danger" ng-if="vm.editForm.data_apiDocumentation.$error.maxlength">Field is too long</div>
          </td>
        </tr>
        <tr ng-if="vm.cert.privacySecurityFramework !== null">
          <td><label class="control-label" for="data_psFramework{{ vm.cert.number }}">Privacy &amp; Security Framework</label></td>
          <td><select class="form-control input-sm" id="data_psFramework{{ vm.cert.number }}" name="data_psFramework" ng_model="vm.cert.privacySecurityFramework">
              <option value="Approach 1">Approach 1</option>
              <option value="Approach 2">Approach 2</option>
              <option value="Approach 1;Approach 2">Approach 1;Approach 2</option>
          </select></td>
        </tr>
        <tr ng-if="vm.cert.sed !== null">
          <td><label class="control-label" for="data_sed{{ vm.cert.number }}">SED</label></td>
          <td>
            <select class="form-control input-sm" id="data_sed{{ vm.cert.number }}" name="data_sed" ng_model="vm.cert.sed" ng-options="b.value as b.name for b in vm.options" ng-disabled="vm.cert.certificationEdition.name === '2015'"></select>
            <div class="text-warning" ng-if="((vm.editForm.data.$dirty && vm.cert.success) || vm.editForm.data_sed.$dirty) && vm.cert.sed">Use the "Safety Enhanced Design (SED)" panel to edit SED information for this Criteria.</div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="modal-footer">
    <button ng-disabled="vm.editForm.$invalid" class="btn btn-ai-success btn-block" ng-click="vm.save()">Save Certification Criteria</button>
    <button class="btn btn-warning btn-block"
            confirm="Are you sure you wish to cancel editing? Your changes will not be saved."
            confirm-ok="Yes"
            confirm-cancel="No"
            confirm-settings="{animation: false, keyboard: false, backdrop: 'static'}"
            ng-click="vm.cancel()">Cancel Edits</button>
  </div>
</div>
